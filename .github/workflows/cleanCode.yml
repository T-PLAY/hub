
name: Clean code

defaults:
  run:
    shell: bash

on:
  pull_request:
    branches: [ main ]
  push:
    branches: [ main ]

env:
  BUILD_TYPE: Release

jobs:

  cppCheck:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Install cppCheck
      run: sudo apt install -y cppcheck

    - name: Configure CMake
      run: cmake -B "${{github.workspace}}/build" -DCMAKE_BUILD_TYPE=${{env.BUILD_TYPE}}

    - name: CppCheck
      run:
        cppcheck --version
        && cmake --build ${{github.workspace}}/build --target hub-cppCheck
   

  doxygen:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4
    - uses: ssciwr/doxygen-install@v1.3.0

    - name: Configure CMake
      run: cmake -B "${{github.workspace}}/build" -DCMAKE_BUILD_TYPE=${{env.BUILD_TYPE}} -DHUB_BUILD_DOC=ON

    - name: Doxygen
      run:
        doxygen --version &&
        cmake --build ${{github.workspace}}/build --target hub-doc-doxygen


  format:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Install clang-format
      run: 
        sudo apt install -y clang-format
        && clang-format --version
        
    - name: Install cmake-format
      run: 
        sudo apt install -y cmake-format
        && echo "cmake-format version $(cmake-format --version)"
        
    - name: Configure CMake
      run: cmake -B "${{github.workspace}}/build" -DCMAKE_BUILD_TYPE=${{env.BUILD_TYPE}}

        # todo please uncomment these above lines when project was fully formated
    # - name: Format
      # run: cmake --build ${{github.workspace}}/build --target hub-format
        # && git diff --exit-code

